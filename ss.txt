TRUNCATE TABLE T_DAILY_TRANS_SALES_BOM;
		INSERT INTO T_DAILY_TRANS_SALES_BOM
		SELECT
		TIBD.TRANS_ITEM_BOM_ID, TIBD.TRANS_ITEM_ID, TIBD.BOM_VARIANT_ID, TIBD.QUANTITY, TIBD.CONVERSION_FACTOR, TIBD.STOCK_VALUE, TIBDE.TRANS_BOM_RATE, TIBDE.TRANS_BOM_AMOUNT, 
		IVD.ITEM_GROUP, IVD.ITEM_NAME, IVD.VARIANT_NAME, IVD.ITEM_STOCK_UOM_CODE, IVD.ITEM_TYPE_ID, IVD.ITEM_GROUP_ID, IVD.BASE_ITEM_GROUP_ID, IVD.FINENESS, TIBDE.PTRANS_ITEM_BOM_ID, 
		TIBDE.INWARD_TRANS_ITEM_ID, TIBD.SOR_TRANS_ITEM_BOM_ID, TIBD.SRC_STOCK_BOM_ID,TID.ROW_STATUS,0 AS WASTAGE_PER,TIBDE.INWARD_TRANS_ITEM_BOM_ID,0 AS ORG_METAL_RATE,0 AS APPLIED_METAL_RATE
		FROM V_ITEM_VARIANT_RTN_SMRY IVD,T_TRANS_ITEM_BOM_DTL_EXTD TIBDE,T_TRANS_ITEM_BOM_DTL TIBD,T_TRANS_HDR_EXTD EXTD,T_TRANS_ITEM_DTL_EXTD TIDE,T_TRANS_ITEM_DTL TID,T_TRANS_HDR TH
		WHERE
		EXTD.TRANS_ID = TH.TRANS_ID 
		AND TID.TRANS_ID = TH.TRANS_ID
		AND TIBD.TRANS_ITEM_BOM_ID = TIBDE.TRANS_ITEM_BOM_ID
		AND TIBD.BOM_VARIANT_ID = IVD.VARIANT_ID
		AND TIBD.TRANS_ITEM_ID = TID.TRANS_ITEM_ID
		AND TID.TRANS_ITEM_ID = TIDE.TRANS_ITEM_ID
		AND TID.ROW_STATUS IN (1,-2)
		AND TH.ROW_STATUS = 1
		AND EXISTS (SELECT 1 FROM T_DAILY_TRANS_SALES DUS WHERE TIBD.TRANS_ITEM_ID = DUS.TRANS_ITEM_ID);

		UPDATE T_DAILY_TRANS_SALES_BOM DTSB
		SET WASTAGE_PER = NVL((SELECT AVG(TIBFD.ROW_VALUE) FROM T_TRANS_ITEM_BOM_FORMULA_DTL TIBFD,V_FORMULA_PROCEDURE_DTL FPD WHERE DTSB.TRANS_ITEM_BOM_ID = TIBFD.TRANS_ITEM_BOM_ID AND TIBFD.PROCEDURE_ID = FPD.PROCEDURE_ID AND TIBFD.ROW_NO = FPD.ROW_NO AND FPD.ROW_TYPE_ID = 1442),0)
		WHERE EXISTS (SELECT 1 FROM T_DAILY_TRANS_SALES DTS WHERE DTSB.TRANS_ITEM_ID = DTS.TRANS_ITEM_ID);

		UPDATE T_DAILY_TRANS_SALES_BOM DTSB
		SET ORG_METAL_RATE = NVL((SELECT AVG(TIBFD.ROW_VALUE) FROM T_TRANS_ITEM_BOM_FORMULA_DTL TIBFD,V_FORMULA_PROCEDURE_DTL FPD WHERE DTSB.TRANS_ITEM_BOM_ID = TIBFD.TRANS_ITEM_BOM_ID AND TIBFD.PROCEDURE_ID = FPD.PROCEDURE_ID AND TIBFD.ROW_NO = FPD.ROW_NO AND FPD.ROW_TYPE_ID = 1455),0)
		WHERE EXISTS (SELECT 1 FROM T_DAILY_TRANS_SALES DTS WHERE DTSB.TRANS_ITEM_ID = DTS.TRANS_ITEM_ID );
 
		UPDATE T_DAILY_TRANS_SALES_BOM DTSB
		SET APPLIED_METAL_RATE = NVL((SELECT AVG(TIBFD.ROW_VALUE) FROM T_TRANS_ITEM_BOM_FORMULA_DTL TIBFD,V_FORMULA_PROCEDURE_DTL FPD WHERE DTSB.TRANS_ITEM_BOM_ID = TIBFD.TRANS_ITEM_BOM_ID AND TIBFD.PROCEDURE_ID = FPD.PROCEDURE_ID AND TIBFD.ROW_NO = FPD.ROW_NO AND FPD.ROW_TYPE_ID = 1341),0)
		WHERE EXISTS (SELECT 1 FROM T_DAILY_TRANS_SALES DTS WHERE DTSB.TRANS_ITEM_ID = DTS.TRANS_ITEM_ID);

COMMIT;


ALTER TABLE T_DAILY_TRANS_SALES_BOM
  DROP CONSTRAINT PK_DTSB;

ALTER TABLE T_DAILY_TRANS_SALES_BOM ADD (
  CONSTRAINT PK_DTSB
  PRIMARY KEY
  (TRANS_ITEM_BOM_ID)
  ENABLE VALIDATE);


TRUNCATE TABLE T_DAILY_TRANS_ORDER_BOM;
		INSERT INTO T_DAILY_TRANS_ORDER_BOM
		SELECT
		TIBD.TRANS_ITEM_BOM_ID, TIBD.TRANS_ITEM_ID, TIBD.BOM_VARIANT_ID, TIBD.QUANTITY, TIBD.CONVERSION_FACTOR, TIBD.TRANS_BOM_RATE, TIBD.TRANS_BOM_AMOUNT, 
		IVD.ITEM_GROUP, IVD.ITEM_NAME, IVD.VARIANT_NAME, IVD.ITEM_STOCK_UOM_CODE, IVD.ITEM_TYPE_ID, IVD.ITEM_GROUP_ID, IVD.BASE_ITEM_GROUP_ID, IVD.FINENESS
		FROM V_ITEM_VARIANT_RTN_DTL IVD,V_TRANS_ITEM_BOM_DTL TIBD,T_TRANS_HDR_EXTD EXTD,T_TRANS_ITEM_DTL TID,T_TRANS_HDR TH
		WHERE
		EXTD.TRANS_ID = TH.TRANS_ID 
		AND TID.TRANS_ID = TH.TRANS_ID
		AND TIBD.BOM_VARIANT_ID = IVD.VARIANT_ID
		AND TIBD.TRANS_ITEM_ID = TID.TRANS_ITEM_ID 
		AND TH.ROW_STATUS = 1
		AND TID.ROW_STATUS = 1
		AND EXISTS (SELECT 1 FROM T_DAILY_TRANS_ORDER DUO WHERE TIBD.TRANS_ITEM_ID = DUO.TRANS_ITEM_ID);
		COMMIT;




T_DAILY_TRANS_ORDER_BOM

T_DAILY_TRANS_SALES_BOM

T_SMRY_STOCK_DAILY_CLOSING

T_SMRY_STOCK_MONTH_CLOSING

T_STOCK_ARCHIVE


ALTER TABLE T_DAILY_TRANS_MFGR_BOM ADD (
  CONSTRAINT PK_DTMFGRBOM
  PRIMARY KEY
  (TRANS_ITEM_BOM_ID)
  ENABLE VALIDATE);
  
  ALTER TABLE T_SMRY_STOCK_MONTH_CLOSING ADD PK_ID NUMBER (10);

update T_SMRY_STOCK_MONTH_CLOSING set pk_id = SMRY_STOCK_MONTH_CLOSING.nextval

ALTER TABLE T_SMRY_STOCK_DAILY_CLOSING
  DROP CONSTRAINT PK_SSDC;

ALTER TABLE T_SMRY_STOCK_DAILY_CLOSING ADD (
  CONSTRAINT PK_SSDC
  PRIMARY KEY
  (PK_ID)
  ENABLE VALIDATE);


ALTER TABLE T_DAILY_TRANS_MFGR_BOM
  DROP CONSTRAINT PK_DTMFGRBOM;

ALTER TABLE T_DAILY_TRANS_MFGR_BOM ADD (
  CONSTRAINT PK_DTMFGRBOM
  PRIMARY KEY
  (TRANS_ITEM_BOM_ID)
  ENABLE VALIDATE);


ALTER TABLE T_DAILY_TRANS_MFGR_INOUT
  DROP CONSTRAINT PK_DTMI;

ALTER TABLE T_DAILY_TRANS_MFGR_INOUT ADD (
  CONSTRAINT PK_DTMI
  PRIMARY KEY
  (STOCK_IN_OUT_DTL_ID)
  ENABLE VALIDATE);

SELECT STOCK_IN_OUT_DTL_ID, COUNT (*) FROM T_DAILY_TRANS_MFGR_INOUT
GROUP BY STOCK_IN_OUT_DTL_ID
HAVING COUNT (*) > 1

UPDATE T_DAILY_TRANS_MFGR_INOUT SET STOCK_IN_OUT_DTL_ID = STOCK_IN_OUT_DTL.NEXTVAL
WHERE STOCK_IN_OUT_DTL_ID = 0


ALTER TABLE T_DAILY_TRANS_ORDER_BOM
  DROP CONSTRAINT PK_DTOB;

ALTER TABLE T_DAILY_TRANS_ORDER_BOM ADD (
  CONSTRAINT PK_DTOB
  PRIMARY KEY
  (TRANS_ITEM_BOM_ID)
  ENABLE VALIDATE);


ALTER TABLE T_SMRY_STOCK_MONTH_CLOSING
  DROP CONSTRAINT PK_SSMC;

ALTER TABLE T_SMRY_STOCK_MONTH_CLOSING ADD (
  CONSTRAINT PK_SSMC
  PRIMARY KEY
  (PK_ID)
  ENABLE VALIDATE);
